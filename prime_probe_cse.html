<!DOCTYPE html>
<html>
    <head>
        <title>104_cse_experiment</title>
        <script src="jspsych/dist/jspsych.js"></script>
        <script src="jspsych/dist/plugin-html-keyboard-response.js"></script>
        <script src="jspsych/dist/plugin-html-button-response.js"></script>
        <script src="jspsych/dist/plugin-survey-likert.js"></script>
        <script src="jspsych/dist/plugin-fullscreen.js"></script>
        <script src="mytrials.js"></script>
        <script src="https://unpkg.com/@jspsych-contrib/plugin-html-vas-response@1.2.0"></script>
        <link href="jspsych/dist/jspsych.css" rel="stylesheet" type="text/css" />
    </head>
    <body></body>
    <script>

        ///optional sytling///
        var styles = `
        p{
            text-align: justify;
            max-width:800px;
            margin: auto;
            margin-bottom: 20px;
        }
        ul {
            text-align: left;
            list-style-position: inside;
            margin-left: 20px;
            }
        li {
            margin-bottom: 5px;
        }    
    `
        var styleSheet = document.createElement("style")
        styleSheet.type = "text/css"
        styleSheet.innerText = styles
        document.head.appendChild(styleSheet)
        ///////////////////////


        ///Necessary functions/// --> call back function when the experiment is finished
        ///var jspsych = initJsPsych({
        /// experiment_width: 1000,
        /// on_finish: function(){
        ///    window.location = "ide_majd_valami"
        //    }
        //});


        var subj_code; //a variable that later stores a random subject code
        function makeid(length) {
            var result = '';
            var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            var charactersLength = characters.length;
            for (var i = 0; i < length; i++) {
                result += characters.charAt(Math.floor(Math.random() * charactersLength));
            }
            return result;
        } //this function generates a random string of characters

        var jsPsych = initJsPsych({
      on_finish: function() {
        jsPsych.data.displayData();
      }
    });

        subj_code = makeid(6); //generating a random subject code

        console.log(subj_code); //printing the subject code to the console

        jsPsych.data.addProperties({subj_code: subj_code}); //adding the subject code to the data object

        var timeline = [];
       
        /*defining welcome message*/
        var welcome = {
            type: jsPsychHtmlButtonResponse,
            stimulus: `
            <img src="Experimental material/University_logo.png" alt=University Logo" style="width: 300px; display: block; margin: auto;">
            <h2>Üdvözlünk a Metatudomány kutatócsoport vizsgálatában!</h2>
                <p>Egy tudományos kutatásban veszel részt, amelynek vezetője Bognár Miklós, az ELTE Affektív Pszichológia Tanszékének kutatója. 
                A kutatás célja megvizsgálni, hogy miként hatnak a büntetés által kiváltott negatív motivációs állapotok a kognitív kontrollra.</p>
                <h3>Részvétel</h3>
                <p>A kutatásban való részvétel teljesen önkéntes. A vizsgálatot bármikor indoklás nélkül megszakíthatod. Ha bármilyen kérdésed, észrevételed vagy problémád van a kutatással kapcsolatban, írj Bognár Miklósnak a <a href="mailto:bognar.miklos@ppk.elte.hu">bognar.miklos@ppk.elte.hu</a> címre.</p>`,
            choices: ['Tovább']
        };
        timeline.push(welcome);

        //Fullscreen//
        timeline.push({
        type: jsPsychFullscreen,
        fullscreen_mode: true,
        message: "<p>A kísérlet teljes képernyős módra vált.</p>",
        button_label: 'Tovább'
        });
        ////////

        /*data handling and informed consent*/
        var data_handling = {
            type: jsPsychHtmlButtonResponse,
            stimulus: `<h2 style="text-align: center;">Adatkezelési tájékoztató</h2>
                <p style="text-align: justify; max-width: 800px; margin: auto;">Szigorúan bizalmasan kezelünk minden olyan személyes információt, amit a kutatás keretén belül gyűjtünk össze. 
                    A kutatás során nyert adatokat kóddal ellátva biztonságos számítógépeken tároljuk. A kutatás során nyert adatokat összegezzük. 
                    Az ELTE PPK Affektív Pszichológia Tanszék Metatudomány Kutatócsoportja, mint adatkezelő, fenti személyes adataidat bizalmasan kezeli, más adatkezelőnek, adatfeldolgozónak nem adja át.
                    E tényállás részleteit a <a href="http://metasciencelab.elte.hu/hozzajarulas-adatkezeleshez/" target=_blank">"Hozzájárulás adatkezeléshez"</a> c. dokumentum tartalmazza.</p>

                <p>Az adatkezelésről szóló szabályzásról részletesebben pedig itt tájékozódhatsz:
                        <a href="https://ppk.elte.hu/file/Hozzajarulas_adatkezeleshez_melleklet_2018.pdf" target="_blank">Hozzájárulás adatkezeléshez melléklet</a></p>
                <p>A kutatás során nyert személyes adataidat arra használjuk fel, hogy regisztrálhassuk a részvételért járó kurzuspontokat és a pénzjutalmat. 
                Az azonosítására alkalmas adatokat (NEPTUN kód) ezután törölni fogjuk. A kezelt adatok a következők:</p>

                        <ul>
                            <li>NEPTUN-kód</li>
                            <li>Életkor</li>
                            <li>Nem</li>
                            <li>Iskolai végzettség</li>
                        </ul>
                <p>Válaszaid nem lesznek semmilyen módon hozzád köthetők. Az anonimizált adataidat más kutatókkal megosztjuk.</p>
                <p><strong>Kérlek, amennyiben egyetértesz a fenti feltételekkel, és hozzájárulsz a kutatásban való részvételhez, kattints az "Igen" gombra.</strong></p>`,
            choices: ['Igen']
                        };
        timeline.push(data_handling);

        /*informed consent*/
        var informed_consent = {
            type:jsPsychHtmlButtonResponse,
            stimulus: `<h2>Beleegyező nyilatkozat</h2>
                <p>Felelősségem teljes tudatában kijelentem, hogy a mai napon az Eötvös Loránd Tudományegyetem, Bognár Miklós kutatásvezető által végzett vizsgálatban</p>
                 <ul>
                    <li>önként veszek részt.</li>
                    <li>a vizsgálat jellegéről, annak megkezdése előtt kielégítő tájékoztatást kaptam.</li>
                    <li>nem szenvedek semmilyen pszichiátriai betegségben.</li>
                    <li>a vizsgálat idején alkohol vagy drogok hatása alatt nem állok.</li>
                 </ul>

                <p>Tudomásul veszem, hogy az azonosításomra alkalmas személyi adataimat bizalmasan kezelik.
                    Hozzájárulok ahhoz, hogy a vizsgálat során a rólam felvett, személyem azonosítására nem alkalmas adatok más kutatók számára is hozzáférhetők legyenek.
                    Fenntartom a jogot arra, hogy a vizsgálat során annak folytatásától bármikor elállhassak. 
                    Ilyen esetben a rólam addig felvett adatokat törölni kell.</p>

                <p>Tudomásul veszem, hogy csak a teljesen befejezett kitöltésért kapok pontot és pénzjutalmat a <em>Pszichológiai kísérletben és tudományos aktivitásban való részvétel</em> nevű kurzuson.</p>

                <p><strong>A kutatásban való részvételem körülményeiről részletes tájékoztatást kaptam, a feltételekkel egyetértek. 
                    Amennyiben egyetértesz a fenti feltételekkel, kattints az "Igen" gombra.</strong></p>`,
            choices: ['Igen']
                        };
        timeline.push(informed_consent);

        /*instructions*/
        var instructions = {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: `<h2>Instrukciók</h2>
                <p>Ebben a kísérletben arra vagyunk kíváncsiak, hogy miként befolyásolja a büntetés a konfliktusfeldolgozást. 
                A kísérlet során iránymegjelöléseket fogsz olvasni (FEL, LE, JOBB, BAL). Először egy prime inger fog megjelenni a képernyőn, amin egy irány (pl.: „FEL”) lesz olvasható egymás alatt háromszor. 
                Ezt követően megjelenik a célinger, ami vagy azonos („FEL”) vagy ellentétes („LE”) lesz az előtte bemutatott iránnyal.
                A feladatod az lesz, hogy minél gyorsabban és pontosabban eltaláld a célinger irányát a hozzárendelt billentyű megnyomásával. Fontos, hogy a lehető leggyorsabban reagálj, de közben figyelj a pontosságra is!</p> 
                <p>Kérlek helyezd a billentyűzetre a kezedet a képen látható módon:</p>
                <p>A bal középső ujjad az „f”-re, a mutató ujjad a „g”-re, míg a jobb mutató ujjad a „n”-re, a középső ujjad pedig a „j”-re!</p>
                <img src="Experimental material/instruction_pic.png" alt="Hand placemante instructions" style="width: 40%; height: 40%;">
                <p style="text-align: center;"><em>Amennyiben készen állsz a kísérlet megkezdésére, nyomj meg egy tetszőleges billentyűt!</em></p>`,
            choices: "ALL_KEYS"
        };
        timeline.push(instructions);
   

        //Fixation cross//
        var fixation = {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: '<div style="font-size:60px;">+</div>',
            choices: "NO_KEYS",
            trial_duration: function() {
            return Math.random() * (600 - 400) + 400;},
            data: {
                task: 'fixation'
            }
        }

        //Prime//
        var prime_trial = {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: jsPsych.timelineVariable('prime'),
            choices: "NO_KEYS",
            trial_duration: 500,
            data:{
                task:"prime"
            }
        }

        //Blank//
        var blank = {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: ' ',
            choices: "NO_KEYS",
            trial_duration: 33,
            data:{
                task:"blank"
            }
        }

        //Probe//
        var probe_trial = {
            type: jsPsychHtmlKeyboardResponse,            
            stimulus: jsPsych.timelineVariable('probe'),
            choices: ["f", "j", "g", "n"],
            stimulus_duration: 133,
            data: {
                correct_response: jsPsych.timelineVariable('correct_response'),
                task: "probe",
                congruency: jsPsych.timelineVariable('congruency'),
                name: jsPsych.timelineVariable('name'),
                dog: "cat"
            },
            on_finish: function(data) {
                data.correct = data.response === data.correct_response;
            }
        }

        //Feedback//
        var feedback = {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: function() {
            var feedback_text;
            var last_trial = jsPsych.data.getLastTrialData().values()[0].correct;
            console.log(last_trial);
            if (last_trial) {
                feedback_text = "<span style=font-size: 35px; color: black;>✔</span>";
            } else { feedback_text = '<div style="font-size: 35px; color: black;">✘<br>5 Ft-ot veszítettél</div>';
            }
            return feedback_text
            },
            choices: "NO_KEYS",
            trial_duration: 700
        }
       
        var goodbye = {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: `<h2>Kísérlet vége</h2>
                <p>Köszönjük, hogy részt vettél a vizsgálatban!</p>`,
            choices: "ALL_KEYS"
        }

            
        
        //összefoglaló változó//
        const trial_sequence = {
            timeline: [fixation,prime_trial,blank,probe_trial, feedback],
            timeline_variables: prime_probe_trials,
        }

        timeline.push(trial_sequence);
        timeline.push(goodbye);
        jsPsych.run(timeline);

        
    </script>
</html>